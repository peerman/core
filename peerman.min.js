/*! peerman 07-04-2013 */
var io="undefined"==typeof module?{}:module.exports;(function(){(function(e,t){var n=e;n.version="0.9.11",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,o){var i,r,s=n.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),i=n.util.uniqueUri(s);var c={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(c,o),(c["force new connection"]||!n.sockets[i])&&(r=new n.Socket(c)),!c["force new connection"]&&r&&(n.sockets[i]=r),r=r||n.sockets[i],r.of(s.path.length>1?s.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},o=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=o.exec(e||""),n={},r=14;r--;)n[i[r]]=t[r]||"";return n},n.uniqueUri=function(e){var n=e.protocol,o=e.host,i=e.port;return"document"in t?(o=o||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(o=o||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+o+":"+(i||80)},n.query=function(e,t){var o=n.chunkQuery(e||""),i=[];n.merge(o,n.chunkQuery(t||""));for(var r in o)o.hasOwnProperty(r)&&i.push(r+"="+o[r]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){for(var t,n={},o=e.split("&"),i=0,r=o.length;r>i;++i)t=o[i].split("="),t[0]&&(n[t[0]]=t[1]);return n};var r=!1;n.load=function(e){return"document"in t&&"complete"===document.readyState||r?e():(n.on(t,"load",e,!1),void 0)},n.on=function(e,t,n,o){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,o)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){r=!0}),n.defer=function(e){return n.ua.webkit&&"undefined"==typeof importScripts?(n.load(function(){setTimeout(e,100)}),void 0):e()},n.merge=function(e,t,o,i){var r,s=i||[],c=o===void 0?2:o;for(r in t)t.hasOwnProperty(r)&&0>n.indexOf(s,r)&&("object"==typeof e[r]&&c?n.merge(e[r],t[r],c-1,s):(e[r]=t[r],s.push(t[r])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var o=[],i=e.length>t.length?e:t,r=e.length>t.length?t:e,s=0,c=r.length;c>s;s++)~n.indexOf(i,r[s])&&o.push(r[s]);return o},n.indexOf=function(e,t,n){for(var o=e.length,n=0>n?0>n+o?0:n+o:n||0;o>n&&e[n]!==t;n++);return n>=o?-1:n},n.toArray=function(e){for(var t=[],n=0,o=e.length;o>n;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(io!==void 0?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){o.removeListener(e,n),t.apply(this,arguments)}var o=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var o=this.$events[e];if(t.util.isArray(o)){for(var i=-1,r=0,s=o.length;s>r;r++)if(o[r]===n||o[r].listener&&o[r].listener===n){i=r;break}if(0>i)return this;o.splice(i,1),o.length||delete this.$events[e]}else(o===n||o.listener&&o.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var o=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,o);else{if(!t.util.isArray(n))return!1;for(var i=n.slice(),r=0,s=i.length;s>r;r++)i[r].apply(this,o)}return!0}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return 10>e?"0"+e:e}function date(e){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,o,i,r,s,c=gap,a=t[e];switch(a instanceof Date&&(a=date(e)),"function"==typeof rep&&(a=rep.call(t,e,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?a+"":"null";case"boolean":case"null":return a+"";case"object":if(!a)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(a)){for(r=a.length,n=0;r>n;n+=1)s[n]=str(n,a)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+c+"]":"["+s.join(",")+"]",gap=c,i}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(o=rep[n],i=str(o,a),i&&s.push(quote(o)+(gap?": ":":")+i));else for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(i=str(o,a),i&&s.push(quote(o)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+c+"}":"{"+s.join(",")+"}",gap=c,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,o,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o=walk(i,n),void 0!==o?i[n]=o:delete i[n]);return reviver.call(e,t,i)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(io!==void 0?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},o=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],r=n.advice=["reconnect"],s=t.JSON,c=t.util.indexOf;n.encodePacket=function(e){var t=c(o,e.type),n=e.id||"",a=e.endpoint||"",u=e.ack,p=null;switch(e.type){case"error":var h=e.reason?c(i,e.reason):"",f=e.advice?c(r,e.advice):"";(""!==h||""!==f)&&(p=h+(""!==f?"+"+f:""));break;case"message":""!==e.data&&(p=e.data);break;case"event":var l={name:e.name};e.args&&e.args.length&&(l.args=e.args),p=s.stringify(l);break;case"json":p=s.stringify(e.data);break;case"connect":e.qs&&(p=e.qs);break;case"ack":p=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var d=[t,n+("data"==u?"+":""),a];return null!==p&&void 0!==p&&d.push(p),d.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,o=e.length;o>n;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",c={type:o[t[1]],endpoint:t[4]||""};switch(n&&(c.id=n,c.ack=t[3]?"data":!0),c.type){case"error":var t=e.split("+");c.reason=i[t[0]]||"",c.advice=r[t[1]]||"";break;case"message":c.data=e||"";break;case"event":try{var u=s.parse(e);c.name=u.name,c.args=u.args}catch(p){}c.args=c.args||[];break;case"json":try{c.data=s.parse(e)}catch(p){}break;case"connect":c.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(c.ackId=t[1],c.args=[],t[3]))try{c.args=t[3]?s.parse(t[3]):[]}catch(p){}break;case"disconnect":case"heartbeat":}return c},n.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],o=1,i="";e.length>o;o++)"�"==e.charAt(o)?(t.push(n.decodePacket(e.substr(o+1).substr(0,i))),o+=Number(i)+1,i=""):i+=e.charAt(o);return t}return[n.decodePacket(e)]}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var o=0,i=n.length;i>o;o++)this.onPacket(n[o])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(e,t,n){function o(e){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var o=this;t.util.on(n,"beforeunload",function(){o.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=o,t.util.mixin(o,t.EventEmitter),o.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},o.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},o.prototype.handshake=function(e){function n(t){t instanceof Error?(o.connecting=!1,o.onError(t.message)):e.apply(null,t.split(":"))}var o=this,r=this.options,s=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var c=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=s+"&jsonp="+t.j.length,c.parentNode.insertBefore(a,c),t.j.push(function(e){n(e),a.parentNode.removeChild(a)})}else{var u=t.util.request();u.open("GET",s,!0),this.isXDomain()&&(u.withCredentials=!0),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?n(u.responseText):403==u.status?o.onError(u.responseText):(o.connecting=!1,!o.reconnecting&&o.onError(u.responseText)))},u.send(null)}},o.prototype.getTransport=function(e){for(var n,o=e||this.transports,i=0;n=o[i];i++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck(this)))return new t.Transport[n](this,this.sessionid);return null},o.prototype.connect=function(e){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(o,i,r,s){function c(e){return n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e),n.transport?(n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){for(var e=n.transports;e.length>0&&e.splice(0,1)[0]!=n.transport.name;);e.length?c(e):n.publish("connect_failed")}},n.options["connect timeout"]))}),void 0):n.publish("connect_failed")}n.sessionid=o,n.closeTimeout=1e3*r,n.heartbeatTimeout=1e3*i,n.transports||(n.transports=n.origTransports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},o.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)}},o.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},o.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},o.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},o.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},o.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1),e.send(null),this.onDisconnect("booted")},o.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},o.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},o.prototype.onOpen=function(){this.open=!0},o.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},o.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},o.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},o.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},o.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){return n.reconnecting?n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):(n.reconnectionAttempts++>=o?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transports=n.origTransports,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(r>n.reconnectionDelay&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,o=this.options["max reconnection attempts"],i=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new o(this,"json"),this.ackPackets=0,this.acks={}}function o(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],o={type:"event",name:e};return"function"==typeof n&&(o.id=++this.ackPackets,o.ack="data",this.acks[o.id]=n,t=t.slice(0,t.length-1)),o.args=t,this.packet(o)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){o.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var o=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},o.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},o.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(e,t,n){function o(){t.Transport.apply(this,arguments)}e.websocket=o,t.util.inherit(o,t.Transport),o.prototype.name="websocket",o.prototype.open=function(){var e,o=t.util.query(this.socket.options.query),i=this;return e||(e=n.MozWebSocket||n.WebSocket),this.websocket=new e(this.prepareUrl()+o),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(e){i.onError(e)},this},o.prototype.send=t.util.ua.iDevice?function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:function(e){return this.websocket.send(e),this},o.prototype.payload=function(e){for(var t=0,n=e.length;n>t;t++)this.packet(e[t]);return this},o.prototype.close=function(){return this.websocket.close(),this},o.prototype.onError=function(e){this.socket.onError(e)},o.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},o.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},o.xdomainCheck=function(){return!0},t.transports.push("websocket")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t,n){function o(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=o,t.util.inherit(o,t.Transport),o.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},o.prototype.payload=function(e){for(var n=[],o=0,i=e.length;i>o;o++)n.push(t.parser.encodePacket(e[o]));this.send(t.parser.encodePayload(n))},o.prototype.send=function(e){return this.post(e),this},o.prototype.post=function(e){function t(){4==this.readyState&&(this.onreadystatechange=i,r.posting=!1,200==this.status?r.socket.setBuffer(!1):r.onClose())}function o(){this.onload=i,r.socket.setBuffer(!1)}var r=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=o:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},o.prototype.close=function(){return this.onClose(),this},o.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),o=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+o,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},o.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},o.check=function(e,o){try{var i=t.util.request(o),r=n.XDomainRequest&&i instanceof XDomainRequest,s=e&&e.options&&e.options.secure?"https:":"http:",c=n.location&&s!=n.location.protocol;if(i&&(!r||!c))return!0}catch(a){}return!1},o.xdomainCheck=function(e){return o.check(e,!0)}}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t){function n(){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,o=t.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+o,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(o){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(e){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(o){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports),function(e,t,n){function o(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=o,t.util.inherit(o,t.Transport.XHR),t.util.merge(o,t.Transport.XHR),o.prototype.name="xhr-polling",o.prototype.heartbeats=function(){return!1},o.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},o.prototype.get=function(){function e(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(r.onData(this.responseText),r.get()):r.onClose())}function t(){this.onload=i,this.onerror=i,r.retryCounter=1,r.onData(this.responseText),r.get()}function o(){r.retryCounter++,!r.retryCounter||r.retryCounter>3?r.onClose():r.get()}if(this.isOpen){var r=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=o):this.xhr.onreadystatechange=e,this.xhr.send(null)}},o.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},o.prototype.ready=function(e,n){var o=this;t.util.defer(function(){n.call(o)})},t.transports.push("xhr-polling")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t,n){function o(){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var e=this;t.j.push(function(t){e._(t)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=o,t.util.inherit(o,t.Transport["xhr-polling"]),o.prototype.name="jsonp-polling",o.prototype.post=function(e){function n(){o(),i.socket.setBuffer(!1)}function o(){i.iframe&&i.form.removeChild(i.iframe);try{s=document.createElement('<iframe name="'+i.iframeId+'">')}catch(e){s=document.createElement("iframe"),s.name=i.iframeId}s.id=i.iframeId,i.form.appendChild(s),i.iframe=s}var i=this,r=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var s,c=document.createElement("form"),a=document.createElement("textarea"),u=this.iframeId="socketio_iframe_"+this.index;c.className="socketio",c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.display="none",c.target=u,c.method="POST",c.setAttribute("accept-charset","utf-8"),a.name="d",c.appendChild(a),document.body.appendChild(c),this.form=c,this.area=a}this.form.action=this.prepareUrl()+r,o(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(p){}this.iframe.attachEvent?s.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},o.prototype.get=function(){var e=this,n=document.createElement("script"),o=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+o,n.onerror=function(){e.onClose()};var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r),this.script=n,i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},o.prototype.ready=function(e,n){var o=this;return i?(t.util.load(function(){n.call(o)}),void 0):n.call(this)},o.check=function(){return"document"in n},o.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})})(),function(){function e(t){return e.enabled(t)?function(n){var o=new Date,i=o-(e[t]||o);e[t]=o,n=t+" "+n+" +"+e.humanize(i),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function t(e,t){for(var n in t.prototype)e.prototype[n]=t.prototype[n]}function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})}function o(){var e="peerman-peer-id",t=localStorage.getItem(e);return t||(t=n(),localStorage.setItem(e,t)),t}function i(e,t){function n(n){i=!1,o=Date.now(),e.apply(t,n)}var o=0,i=!1;this.triggerIn=function(e,t){if(!i){var r=Date.now(),s=r-o;s>e?n(t):(i=!0,setTimeout(function(){n(t)},e-s))}}}function r(e){var t,n,o,i=document.cookie.split(";");for(t=0;i.length>t;t++)if(n=i[t].substr(0,i[t].indexOf("=")),o=i[t].substr(i[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n==e)return unescape(o)}function s(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src,n=t.split("?")[1],o={};if(n){var i=n.split("&");i.forEach(function(e){var t=e.split("=");o[t[0]]=t[1]})}return o}function c(t,n,o){this.resource=t,this.peerId=n,this.type=o,this.connected=!1,this.logger=e("peer:"+n),this.iceLogger=e("peer-ice:"+n);var i={iceServers:[{url:"stun:stun.l.google.com:19302"}]},r=this.me=new RTCPeerConnection(i,{optional:[{RtpDataChannels:!0}]}),s=this.meData=r.createDataChannel("default",{reliable:!1});r.onicecandidate=this._onIceCandidate.bind(this),r.onicechange=this._onIceChange.bind(this),s.onmessage=this._notifyMessage.bind(this),s.onopen=this._notifyOpen.bind(this)}function a(t,n,o,s){function c(){var e=n.getConnectedPeerNames();r("peerman-login-token"),t.emit("init-resource",o,f,{totalInterested:l,connectedPeers:e,timestamp:Date.now()}),t.once("init-success-"+f,function(){g.triggerIn(0,[m])})}function a(e){if(d("receiving peers to connect: "+JSON.stringify(e)),0==e.length)h();else{var t=0;e.forEach(function(e){n.peers[e]||(n.connectNew(e,{timeout:s.offerTimeout}),t++)}),t!=m&&h()}}function u(e){d("connected with new peer: "+e.peerId+" type: "+e.type),t.emit("add-peer",f,e.peerId),e.on("disconnected",p),h()}function p(){this.removeListener("disconnected",p),t.emit("remove-peer",f,this.peerId),h()}function h(){if(!y){var e=n.canHaveMorePeers(m);e>0&&g.triggerIn(2e3,[e])}}s=s||{};var f,l,d=e("directory"),m=2,y=!1;this.connect=function(e,o){f=e,l=o,t.socket.connected&&c(),t.on("connect",c),n.on("peer",u)},this.close=function(){y=!0,t.removeListener("connect",c),n.removeListener("peer",u)};var g=new i(function g(e){d("findiing peers for resource: "+f+" count: "+e),t.emit("request-peers",f,e),t.once("peers-found-"+f,a)},this)}function u(e){function t(t){this.set=function(o,i){if("object"!=typeof o)throw Error("First argument need to be an object!");e.emit("set-metadata",t,o),e.once("set-metadata-"+t,n(i))},this.get=function(o,i){if("string"==typeof o||"number"==typeof o)o=[o];else if(!o instanceof Array)throw Error("First argument need be a key or array of keys");e.emit("get-metadata",t,o),e.once("get-metadata-"+t,n(i))},this.getAll=function(o){e.emit("get-all-metadata",t),e.once("get-all-metadata-"+t,n(o))},this.remove=function(o,i){if("string"==typeof o||"number"==typeof o)o=[o];else if(!o instanceof Array)throw Error("First argument need be a key or array of keys");e.emit("remove-metadata",o),e.emit("remove-metadata-"+t,n(i))
}}function n(e){return function(){arguments[0]&&(arguments[0]=Error(arguments[0])),e.apply(null,arguments)}}this.createResource=function(t){e.emit("create-resource"),e.once("create-resource",n(t))},this.removeResource=function(t){e.emit("remove-resource"),e.once("remove-resource",n(t))},this.getResource=function(t){e.emit("get-resource"),e.once("get-resource",n(t))},this.loadMetadata=function(e){return new t(e)}}function p(t,n,o,i,r){function s(e,t,n){k("answer from: "+e+" with status: "+t);var o=y.peers[e];o?"ACCEPTED"==t?o.setRemote(n):o.close():k("no connection to answer: "+e)}function a(e,o){if(k("offer from: "+e),y.peers[e])k("offer rejected because of exisitng from: "+e),t.emit("answer",n,e,"REJECTED");else if(y.canHaveMorePeers(1)){var i=new c(n,e,"answered");i?(i.on("disconnected",l),i.on("candidate",h),i.on("connected",f),i.answer(o,function(o){t.emit("answer",n,e,"ACCEPTED",o)}),y.peers[e]=i,r.answerTimeout&&d(e,r.answerTimeout)):k("no connection to offer: "+e)}else k("rejecting peer due to maxPeers limit: "+e)}function u(e,t){var n=y.peers[e];n?n.addCandidate(t):k("no connection to offer ice-candidate: "+e)}function p(e,t){if(k("server error on: "+e+" error: "+JSON.stringify(t)),t&&"NO_CLIENT"==t.code){var n=y.peers[t.to];n&&n.close()}}function h(e){t.emit("ice-candidate",n,this.peerId,e)}function f(){i>g?(k("connecting: "+this.peerId),g++,y.emit("peer",this),this.removeListener("connected",f),m(this.peerId)):(k("connection dropped due to maxPeers limit: "+this.peerId),this.close())}function l(){k("disconnecting: "+this.peerId),g--,delete y.peers[this.peerId],this.removeListener("disconnected",l),this.removeListener("candidate",h),this.removeListener("connected",f),m(this.peerId)}function d(e,t){v[e]=setTimeout(function(){var n=y.peers[e];n&&!n.connected&&(k("timeouting: "+e+" after: "+t),n.close(),v[e]=null)},t)}function m(e){var t=v[e];t&&(k("clearing timeout handler for: "+e),clearTimeout(t),v[e]=null)}r=r||{};var y=this;this.peers={};var g=0,v={},k=e("connection-manager");this.connectNew=function(e,o){o=o||{},k("start connecting with peer: "+e);var i=new c(n,e,"offered");i.on("disconnected",l),i.on("candidate",h),i.on("connected",f),this.peers[e]=i,i.offer(function(o){t.emit("offer",n,e,o)}),o.timeout&&d(e,o.timeout)},this.getConnectedPeerNames=function(){var e=[];for(var t in this.peers)this.peers[t].connected&&e.push(t);return t},this.getConnectedPeerCount=function(){return g},this.canHaveMorePeers=function(e){var t=i-g;return t>0?t>e?e:t:0},this.close=function(){t.removeListener("answer-"+n,s),t.removeListener("offer-"+n,a),t.removeListener("ice-candidate-"+n,u),t.removeListener("error-"+n,p);for(var e in this.peers)this.peers[e].close()},t.on("answer-"+n,s),t.on("offer-"+n,a),t.on("ice-candidate-"+n,u),t.on("error-"+n,p)}function h(){function e(){t.emit("init",i,s)}var t,n,i=this.peerId=o(),s=r("peerman-login-token"),c={};this.connect=function(o){o=o||"http://localhost:5005",t=io.connect(o),n=new u(t),t.socket.connected&&e(),t.on("connect",e),this.createResource=n.createResource.bind(n),this.removeResource=n.removeResource.bind(n),this.getResource=n.getResource.bind(n),this.connect=function(){}},this.disconnect=function(){for(var n in c)c[n].leave();t.removeListener("connect",e),t.disconnect()},this.join=function(e,o){o=o||{},o.maxPeers=o.maxPeers||5,o.answerTimeout=o.answerTimeout||6e4,o.offerTimeout=o.offerTimeout||6e4;var r=new f(i,t);return r.connect(e,o),r.metadata=n.loadMetadata(e),c[e]=r,r}}function f(e,t){function n(e){r.emit("peer",e)}var o,i,r=this;this.connect=function(r,s){var c={answerTimeout:s.answerTimeout};o=new p(t,r,e,s.maxPeers,c),o.on("peer",n);var u={offerTimeout:s.offerTimeout};i=new a(t,o,e,u),i.connect(r,s.maxPeers),this.connect=function(){}},this.leave=function(){o.removeListener("peer",n),i.close(),o.close()}}(function(e){"use strict";function t(){}function n(e,t){if(i)return t.indexOf(e);for(var n=t.length;n--;)if(t[n]===e)return n;return-1}var o=t.prototype,i=Array.prototype.indexOf?!0:!1;o._getEvents=function(){return this._events||(this._events={})},o.getListeners=function(e){var t=this._getEvents();return t[e]||(t[e]=[])},o.addListener=function(e,t){var o=this.getListeners(e);return-1===n(t,o)&&o.push(t),this},o.on=o.addListener,o.once=function(e,t){var n=this;this.on(e,function(){t.apply(n,arguments),n.removeListener(e,t)})},o.removeListener=function(e,t){var o=this.getListeners(e),i=n(t,o);return-1!==i&&(o.splice(i,1),0===o.length&&this.removeEvent(e)),this},o.off=o.removeListener,o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var o,i,r=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"==typeof t)for(o in t)t.hasOwnProperty(o)&&(i=t[o])&&("function"==typeof i?r.call(this,o,i):s.call(this,o,i));else for(o=n.length;o--;)r.call(this,t,n[o]);return this},o.removeEvent=function(e){return e?delete this._getEvents()[e]:delete this._events,this},o.emitEvent=function(e,t){for(var n,o=this.getListeners(e),i=o.length;i--;)n=t?o[i].apply(this,t):o[i].call(this),n===!0&&this.removeListener(e,o[i]);return this},o.trigger=o.emitEvent,o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},"function"==typeof define&&define.amd?define(function(){return t}):e.EventEmitter=t})(this),e.names=[],e.skips=[],e.enable=function(t){try{localStorage.debug=t}catch(n){}for(var o=(t||"").split(/[\s,]+/),i=o.length,r=0;i>r;r++)t=o[r].replace("*",".*?"),"-"===t[0]?e.skips.push(RegExp("^"+t.substr(1)+"$")):e.names.push(RegExp("^"+t+"$"))},e.disable=function(){e.enable("")},e.humanize=function(e){var t=1e3,n=6e4,o=60*n;return e>=o?(e/o).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(0|e/t)+"s":e+"ms"},e.enabled=function(t){for(var n=0,o=e.skips.length;o>n;n++)if(e.skips[n].test(t))return!1;for(var n=0,o=e.names.length;o>n;n++)if(e.names[n].test(t))return!0;return!1},window.localStorage&&e.enable(localStorage.debug),window.RTCPeerConnection||(navigator.mozGetUserMedia?(window.RTCSessionDescription=window.mozRTCSessionDescription,window.RTCPeerConnection=window.mozRTCPeerConnection,window.getUserMedia=navigator.mozGetUserMedia.bind(navigator)):navigator.webkitGetUserMedia&&(window.RTCPeerConnection=window.webkitRTCPeerConnection,window.getUserMedia=navigator.webkitGetUserMedia.bind(navigator))),t(c,EventEmitter),c.prototype.offer=function(e){var t=this;this.me.createOffer(function(n){t.logger("offer created"),t.me.setLocalDescription(n),e(n)})},c.prototype.answer=function(e,t){e instanceof RTCSessionDescription||(e=new RTCSessionDescription(e));var n=this;this.me.setRemoteDescription(e),this.me.createAnswer(function(e){n.logger("answer created"),n.me.setLocalDescription(e),t(e)})},c.prototype.send=function(e){this.logger("sending message: "+e),this.meData.send(e)},c.prototype.setRemote=function(e){e instanceof RTCSessionDescription||(e=new RTCSessionDescription(e)),this.logger("setting remote"),this.me.setRemoteDescription(e)},c.prototype.addCandidate=function(e){this.iceLogger("adding ice candidate: "+e.sdpMid),"disconnected"!=this.me.iceConnectionState&&this.me.addIceCandidate(new RTCIceCandidate(e))},c.prototype.close=function(){this.me.close(),this.me.onicecandidate=null,this.me.onicechange=null,this.meData.onmessage=null,this.meData.onopen=null,this.meData.onclose=null,this.logger("closed"),this.emit("disconnected")},c.prototype._onIceCandidate=function(e){e.candidate&&"data"==e.candidate.sdpMid&&(this.iceLogger("receiving ice candidate: "+e.candidate.candidate),this.emit("candidate",e.candidate))},c.prototype._notifyMessage=function(e){this.logger("receiving message: "+e.data),this.emit("message",e.data)},c.prototype._notifyOpen=function(){this.logger("state changed: connected"),this.connected=!0,this.emit("connected")},c.prototype._onIceChange=function(){this.logger("changing ice status: "+this.me.iceConnectionState),"disconnected"==this.me.iceConnectionState&&this.close()},t(p,EventEmitter),t(f,EventEmitter);var l=s(),d=l.server||"http://localhost:5005";if(l.debug){var m=decodeURI(l.debug).split(",");m.forEach(function(t){e.names.push(RegExp(t.trim()))})}var y=window.peerman=new h;y.connect(d),y.EventEmitter=EventEmitter}();
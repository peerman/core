/*! peerman 07-04-2013 */
var io="undefined"==typeof module?{}:module.exports;(function(){(function(t,e){var n=t;n.version="0.9.11",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,o){var i,r,s=n.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),i=n.util.uniqueUri(s);var c={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(c,o),(c["force new connection"]||!n.sockets[i])&&(r=new n.Socket(c)),!c["force new connection"]&&r&&(n.sockets[i]=r),r=r||n.sockets[i],r.of(s.path.length>1?s.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(t,e){var n=t.util={},o=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(t){for(var e=o.exec(t||""),n={},r=14;r--;)n[i[r]]=e[r]||"";return n},n.uniqueUri=function(t){var n=t.protocol,o=t.host,i=t.port;return"document"in e?(o=o||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(o=o||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+o+":"+(i||80)},n.query=function(t,e){var o=n.chunkQuery(t||""),i=[];n.merge(o,n.chunkQuery(e||""));for(var r in o)o.hasOwnProperty(r)&&i.push(r+"="+o[r]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(t){for(var e,n={},o=t.split("&"),i=0,r=o.length;r>i;++i)e=o[i].split("="),e[0]&&(n[e[0]]=e[1]);return n};var r=!1;n.load=function(t){return"document"in e&&"complete"===document.readyState||r?t():(n.on(e,"load",t,!1),void 0)},n.on=function(t,e,n,o){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,o)},n.request=function(t){if(t&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!t||n.ua.hasCORS))return new XMLHttpRequest;if(!t)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){r=!0}),n.defer=function(t){return n.ua.webkit&&"undefined"==typeof importScripts?(n.load(function(){setTimeout(t,100)}),void 0):t()},n.merge=function(t,e,o,i){var r,s=i||[],c=o===void 0?2:o;for(r in e)e.hasOwnProperty(r)&&0>n.indexOf(s,r)&&("object"==typeof t[r]&&c?n.merge(t[r],e[r],c-1,s):(t[r]=e[r],s.push(e[r])));return t},n.mixin=function(t,e){n.merge(t.prototype,e.prototype)},n.inherit=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},n.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.intersect=function(t,e){for(var o=[],i=t.length>e.length?t:e,r=t.length>e.length?e:t,s=0,c=r.length;c>s;s++)~n.indexOf(i,r[s])&&o.push(r[s]);return o},n.indexOf=function(t,e,n){for(var o=t.length,n=0>n?0>n+o?0:n+o:n||0;o>n&&t[n]!==e;n++);return n>=o?-1:n},n.toArray=function(t){for(var e=[],n=0,o=t.length;o>n;n++)e.push(t[n]);return e},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(io!==void 0?io:module.exports,this),function(t,e){function n(){}t.EventEmitter=n,n.prototype.on=function(t,n){return this.$events||(this.$events={}),this.$events[t]?e.util.isArray(this.$events[t])?this.$events[t].push(n):this.$events[t]=[this.$events[t],n]:this.$events[t]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(t,e){function n(){o.removeListener(t,n),e.apply(this,arguments)}var o=this;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,n){if(this.$events&&this.$events[t]){var o=this.$events[t];if(e.util.isArray(o)){for(var i=-1,r=0,s=o.length;s>r;r++)if(o[r]===n||o[r].listener&&o[r].listener===n){i=r;break}if(0>i)return this;o.splice(i,1),o.length||delete this.$events[t]}else(o===n||o.listener&&o.listener===n)&&delete this.$events[t]}return this},n.prototype.removeAllListeners=function(t){return void 0===t?(this.$events={},this):(this.$events&&this.$events[t]&&(this.$events[t]=null),this)},n.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),e.util.isArray(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]},n.prototype.emit=function(t){if(!this.$events)return!1;var n=this.$events[t];if(!n)return!1;var o=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,o);else{if(!e.util.isArray(n))return!1;for(var i=n.slice(),r=0,s=i.length;s>r;r++)i[r].apply(this,o)}return!0}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(t){return 10>t?"0"+t:t}function date(t){return isFinite(t.valueOf())?t.getUTCFullYear()+"-"+f(t.getUTCMonth()+1)+"-"+f(t.getUTCDate())+"T"+f(t.getUTCHours())+":"+f(t.getUTCMinutes())+":"+f(t.getUTCSeconds())+"Z":null}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,o,i,r,s,c=gap,a=e[t];switch(a instanceof Date&&(a=date(t)),"function"==typeof rep&&(a=rep.call(e,t,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?a+"":"null";case"boolean":case"null":return a+"";case"object":if(!a)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(a)){for(r=a.length,n=0;r>n;n+=1)s[n]=str(n,a)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+c+"]":"["+s.join(",")+"]",gap=c,i}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(o=rep[n],i=str(o,a),i&&s.push(quote(o)+(gap?": ":":")+i));else for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(i=str(o,a),i&&s.push(quote(o)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+c+"}":"{"+s.join(",")+"}",gap=c,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(t,e,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw Error("JSON.stringify");return str("",{"":t})},JSON.parse=function(text,reviver){function walk(t,e){var n,o,i=t[e];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o=walk(i,n),void 0!==o?i[n]=o:delete i[n]);return reviver.call(t,e,i)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(io!==void 0?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(t,e){var n=t.parser={},o=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],r=n.advice=["reconnect"],s=e.JSON,c=e.util.indexOf;n.encodePacket=function(t){var e=c(o,t.type),n=t.id||"",a=t.endpoint||"",u=t.ack,p=null;switch(t.type){case"error":var h=t.reason?c(i,t.reason):"",f=t.advice?c(r,t.advice):"";(""!==h||""!==f)&&(p=h+(""!==f?"+"+f:""));break;case"message":""!==t.data&&(p=t.data);break;case"event":var l={name:t.name};t.args&&t.args.length&&(l.args=t.args),p=s.stringify(l);break;case"json":p=s.stringify(t.data);break;case"connect":t.qs&&(p=t.qs);break;case"ack":p=t.ackId+(t.args&&t.args.length?"+"+s.stringify(t.args):"")}var d=[e,n+("data"==u?"+":""),a];return null!==p&&void 0!==p&&d.push(p),d.join(":")},n.encodePayload=function(t){var e="";if(1==t.length)return t[0];for(var n=0,o=t.length;o>n;n++){var i=t[n];e+="�"+i.length+"�"+t[n]}return e};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(t){var e=t.match(a);if(!e)return{};var n=e[2]||"",t=e[5]||"",c={type:o[e[1]],endpoint:e[4]||""};switch(n&&(c.id=n,c.ack=e[3]?"data":!0),c.type){case"error":var e=t.split("+");c.reason=i[e[0]]||"",c.advice=r[e[1]]||"";break;case"message":c.data=t||"";break;case"event":try{var u=s.parse(t);c.name=u.name,c.args=u.args}catch(p){}c.args=c.args||[];break;case"json":try{c.data=s.parse(t)}catch(p){}break;case"connect":c.qs=t||"";break;case"ack":var e=t.match(/^([0-9]+)(\+)?(.*)/);if(e&&(c.ackId=e[1],c.args=[],e[3]))try{c.args=e[3]?s.parse(e[3]):[]}catch(p){}break;case"disconnect":case"heartbeat":}return c},n.decodePayload=function(t){if("�"==t.charAt(0)){for(var e=[],o=1,i="";t.length>o;o++)"�"==t.charAt(o)?(e.push(n.decodePacket(t.substr(o+1).substr(0,i))),o+=Number(i)+1,i=""):i+=t.charAt(o);return e}return[n.decodePacket(t)]}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(t,e){function n(t,e){this.socket=t,this.sessid=e}t.Transport=n,e.util.mixin(n,e.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(t){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==t){var n=e.parser.decodePayload(t);if(n&&n.length)for(var o=0,i=n.length;i>o;o++)this.onPacket(n[o])}return this},n.prototype.onPacket=function(t){return this.socket.setHeartbeatTimeout(),"heartbeat"==t.type?this.onHeartbeat():("connect"==t.type&&""==t.endpoint&&this.onConnect(),"error"==t.type&&"reconnect"==t.advice&&(this.isOpen=!1),this.socket.onPacket(t),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var t=this;this.closeTimeout=setTimeout(function(){t.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(t){this.send(e.parser.encodePacket(t))},n.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var t=this.socket.options;return this.scheme()+"://"+t.host+":"+t.port+"/"+t.resource+"/"+e.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(t,e){e.call(this)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(t,e,n){function o(t){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:e.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},e.util.merge(this.options,t),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||e.util.ua.hasCORS)){var o=this;e.util.on(n,"beforeunload",function(){o.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}t.Socket=o,e.util.mixin(o,e.EventEmitter),o.prototype.of=function(t){return this.namespaces[t]||(this.namespaces[t]=new e.SocketNamespace(this,t),""!==t&&this.namespaces[t].packet({type:"connect"})),this.namespaces[t]},o.prototype.publish=function(){this.emit.apply(this,arguments);var t;for(var e in this.namespaces)this.namespaces.hasOwnProperty(e)&&(t=this.of(e),t.$emit.apply(t,arguments))},o.prototype.handshake=function(t){function n(e){e instanceof Error?(o.connecting=!1,o.onError(e.message)):t.apply(null,e.split(":"))}var o=this,r=this.options,s=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,e.protocol,e.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!e.util.ua.hasCORS){var c=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=s+"&jsonp="+e.j.length,c.parentNode.insertBefore(a,c),e.j.push(function(t){n(t),a.parentNode.removeChild(a)})}else{var u=e.util.request();u.open("GET",s,!0),this.isXDomain()&&(u.withCredentials=!0),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?n(u.responseText):403==u.status?o.onError(u.responseText):(o.connecting=!1,!o.reconnecting&&o.onError(u.responseText)))},u.send(null)}},o.prototype.getTransport=function(t){for(var n,o=t||this.transports,i=0;n=o[i];i++)if(e.Transport[n]&&e.Transport[n].check(this)&&(!this.isXDomain()||e.Transport[n].xdomainCheck(this)))return new e.Transport[n](this,this.sessionid);return null},o.prototype.connect=function(t){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(o,i,r,s){function c(t){return n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(t),n.transport?(n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){for(var t=n.transports;t.length>0&&t.splice(0,1)[0]!=n.transport.name;);t.length?c(t):n.publish("connect_failed")}},n.options["connect timeout"]))}),void 0):n.publish("connect_failed")}n.sessionid=o,n.closeTimeout=1e3*r,n.heartbeatTimeout=1e3*i,n.transports||(n.transports=n.origTransports=s?e.util.intersect(s.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),t&&"function"==typeof t&&t()})}),this},o.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var t=this;this.heartbeatTimeoutTimer=setTimeout(function(){t.transport.onClose()},this.heartbeatTimeout)}},o.prototype.packet=function(t){return this.connected&&!this.doBuffer?this.transport.packet(t):this.buffer.push(t),this},o.prototype.setBuffer=function(t){this.doBuffer=t,!t&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},o.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},o.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},o.prototype.disconnectSync=function(){var t=e.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,e.protocol,"",this.sessionid].join("/")+"/?disconnect=1";t.open("GET",n,!1),t.send(null),this.onDisconnect("booted")},o.prototype.isXDomain=function(){var t=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=t},o.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},o.prototype.onOpen=function(){this.open=!0},o.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},o.prototype.onPacket=function(t){this.of(t.endpoint).onPacket(t)},o.prototype.onError=function(t){t&&t.advice&&"reconnect"===t.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",t&&t.reason?t.reason:t)},o.prototype.onDisconnect=function(t){var e=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(e||n)&&(this.transport.close(),this.transport.clearTimeouts(),e&&(this.publish("disconnect",t),"booted"!=t&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},o.prototype.reconnect=function(){function t(){if(n.connected){for(var t in n.namespaces)n.namespaces.hasOwnProperty(t)&&""!==t&&n.namespaces[t].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",e),n.removeListener("connect",e),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function e(){return n.reconnecting?n.connected?t():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(e,1e3):(n.reconnectionAttempts++>=o?n.redoTransports?(n.publish("reconnect_failed"),t()):(n.on("connect_failed",e),n.options["try multiple transports"]=!0,n.transports=n.origTransports,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(r>n.reconnectionDelay&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(e,n.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,o=this.options["max reconnection attempts"],i=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports,this),function(t,e){function n(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new o(this,"json"),this.ackPackets=0,this.acks={}}function o(t,e){this.namespace=t,this.name=e}t.SocketNamespace=n,e.util.mixin(n,e.EventEmitter),n.prototype.$emit=e.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},n.prototype.send=function(t,e){var n={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=e),this.packet(n)},n.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),n=e[e.length-1],o={type:"event",name:t};return"function"==typeof n&&(o.id=++this.ackPackets,o.ack="data",this.acks[o.id]=n,e=e.slice(0,e.length-1)),o.args=e,this.packet(o)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(t){function n(){o.packet({type:"ack",args:e.util.toArray(arguments),ackId:t.id})}var o=this;switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":var i=["message",t.data];"data"==t.ack?i.push(n):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,i);break;case"event":var i=[t.name].concat(t.args);"data"==t.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},o.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},o.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(t,e,n){function o(){e.Transport.apply(this,arguments)}t.websocket=o,e.util.inherit(o,e.Transport),o.prototype.name="websocket",o.prototype.open=function(){var t,o=e.util.query(this.socket.options.query),i=this;return t||(t=n.MozWebSocket||n.WebSocket),this.websocket=new t(this.prepareUrl()+o),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(t){i.onData(t.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(t){i.onError(t)},this},o.prototype.send=e.util.ua.iDevice?function(t){var e=this;return setTimeout(function(){e.websocket.send(t)},0),this}:function(t){return this.websocket.send(t),this},o.prototype.payload=function(t){for(var e=0,n=t.length;n>e;e++)this.packet(t[e]);return this},o.prototype.close=function(){return this.websocket.close(),this},o.prototype.onError=function(t){this.socket.onError(t)},o.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},o.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},o.xdomainCheck=function(){return!0},e.transports.push("websocket")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(t,e,n){function o(t){t&&(e.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}t.XHR=o,e.util.inherit(o,e.Transport),o.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},o.prototype.payload=function(t){for(var n=[],o=0,i=t.length;i>o;o++)n.push(e.parser.encodePacket(t[o]));this.send(e.parser.encodePayload(n))},o.prototype.send=function(t){return this.post(t),this},o.prototype.post=function(t){function e(){4==this.readyState&&(this.onreadystatechange=i,r.posting=!1,200==this.status?r.socket.setBuffer(!1):r.onClose())}function o(){this.onload=i,r.socket.setBuffer(!1)}var r=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=o:this.sendXHR.onreadystatechange=e,this.sendXHR.send(t)},o.prototype.close=function(){return this.onClose(),this},o.prototype.request=function(t){var n=e.util.request(this.socket.isXDomain()),o=e.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(t||"GET",this.prepareUrl()+o,!0),"POST"==t)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},o.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},o.check=function(t,o){try{var i=e.util.request(o),r=n.XDomainRequest&&i instanceof XDomainRequest,s=t&&t.options&&t.options.secure?"https:":"http:",c=n.location&&s!=n.location.protocol;if(i&&(!r||!c))return!0}catch(a){}return!1},o.xdomainCheck=function(t){return o.check(t,!0)}}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(t,e){function n(){e.Transport.XHR.apply(this,arguments)}t.htmlfile=n,e.util.inherit(n,e.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var t=this.doc.createElement("div");t.className="socketio",this.doc.body.appendChild(t),this.iframe=this.doc.createElement("iframe"),t.appendChild(this.iframe);var n=this,o=e.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+o,e.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(t,e){this.onData(t);try{var n=e.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(o){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(t){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),e.Transport.XHR.prototype.close.call(this)},n.check=function(t){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&e.Transport.XHR.check(t)}catch(o){}return!1},n.xdomainCheck=function(){return!1},e.transports.push("htmlfile")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports),function(t,e,n){function o(){e.Transport.XHR.apply(this,arguments)}function i(){}t["xhr-polling"]=o,e.util.inherit(o,e.Transport.XHR),e.util.merge(o,e.Transport.XHR),o.prototype.name="xhr-polling",o.prototype.heartbeats=function(){return!1},o.prototype.open=function(){var t=this;return e.Transport.XHR.prototype.open.call(t),!1},o.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(r.onData(this.responseText),r.get()):r.onClose())}function e(){this.onload=i,this.onerror=i,r.retryCounter=1,r.onData(this.responseText),r.get()}function o(){r.retryCounter++,!r.retryCounter||r.retryCounter>3?r.onClose():r.get()}if(this.isOpen){var r=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=o):this.xhr.onreadystatechange=t,this.xhr.send(null)}},o.prototype.onClose=function(){if(e.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(t){}this.xhr=null}},o.prototype.ready=function(t,n){var o=this;e.util.defer(function(){n.call(o)})},e.transports.push("xhr-polling")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(t,e,n){function o(){e.Transport["xhr-polling"].apply(this,arguments),this.index=e.j.length;var t=this;e.j.push(function(e){t._(e)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;t["jsonp-polling"]=o,e.util.inherit(o,e.Transport["xhr-polling"]),o.prototype.name="jsonp-polling",o.prototype.post=function(t){function n(){o(),i.socket.setBuffer(!1)}function o(){i.iframe&&i.form.removeChild(i.iframe);try{s=document.createElement('<iframe name="'+i.iframeId+'">')}catch(t){s=document.createElement("iframe"),s.name=i.iframeId}s.id=i.iframeId,i.form.appendChild(s),i.iframe=s}var i=this,r=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var s,c=document.createElement("form"),a=document.createElement("textarea"),u=this.iframeId="socketio_iframe_"+this.index;c.className="socketio",c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.display="none",c.target=u,c.method="POST",c.setAttribute("accept-charset","utf-8"),a.name="d",c.appendChild(a),document.body.appendChild(c),this.form=c,this.area=a}this.form.action=this.prepareUrl()+r,o(),this.area.value=e.JSON.stringify(t);try{this.form.submit()}catch(p){}this.iframe.attachEvent?s.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},o.prototype.get=function(){var t=this,n=document.createElement("script"),o=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+o,n.onerror=function(){t.onClose()};var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r),this.script=n,i&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},o.prototype._=function(t){return this.onData(t),this.isOpen&&this.get(),this},o.prototype.ready=function(t,n){var o=this;return i?(e.util.load(function(){n.call(o)}),void 0):n.call(this)},o.check=function(){return"document"in n},o.xdomainCheck=function(){return!0},e.transports.push("jsonp-polling")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})})(),function(){function t(e){return t.enabled(e)?function(n){var o=new Date,i=o-(t[e]||o);t[e]=o,n=e+" "+n+" +"+t.humanize(i),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function e(t,e){for(var n in e.prototype)t.prototype[n]=e.prototype[n]}function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=0|16*Math.random(),n="x"==t?e:8|3&e;return n.toString(16)})}function o(){var t="peerman-peer-id",e=localStorage.getItem(t);return e||(e=n(),localStorage.setItem(t,e)),e}function i(t,e){function n(n){i=!1,o=Date.now(),t.apply(e,n)}var o=0,i=!1;this.triggerIn=function(t,e){if(!i){var r=Date.now(),s=r-o;s>t?n(e):(i=!0,setTimeout(function(){n(e)},t-s))}}}function r(t){var e,n,o,i=document.cookie.split(";");for(e=0;i.length>e;e++)if(n=i[e].substr(0,i[e].indexOf("=")),o=i[e].substr(i[e].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n==t)return unescape(o)}function s(){var t=document.getElementsByTagName("script"),e=t[t.length-1].src,n=e.split("?")[1],o={};if(n){var i=n.split("&");i.forEach(function(t){var e=t.split("=");o[e[0]]=e[1]})}return o}function c(e,n,o){this.resource=e,this.peerId=n,this.type=o,this.connected=!1,this.logger=t("peer:"+n),this.iceLogger=t("peer-ice:"+n);var i={iceServers:[{url:"stun:stun.l.google.com:19302"}]},r=this.me=new RTCPeerConnection(i,{optional:[{RtpDataChannels:!0}]}),s=this.meData=r.createDataChannel("default",{reliable:!1});r.onicecandidate=this._onIceCandidate.bind(this),r.onicechange=this._onIceChange.bind(this),s.onmessage=this._notifyMessage.bind(this),s.onopen=this._notifyOpen.bind(this)}function a(e,n,o,s){function c(){var t=n.getConnectedPeerNames(),i=r("peerman-login-token");e.emit("init",{peerId:o,totalInterested:l,connectedPeers:t,resourcesInterested:[f],loginToken:i,timestamp:Date.now()}),e.once("init-success",function(){g.triggerIn(0,[m])})}function a(t){if(d("receiving peers to connect: "+JSON.stringify(t)),0==t.length)h();else{var e=0;t.forEach(function(t){n.peers[t]||(n.connectNew(t,{timeout:s.offerTimeout}),e++)}),e!=m&&h()}}function u(t){d("connected with new peer: "+t.peerId+" type: "+t.type),e.emit("add-peer",t.peerId),t.on("disconnected",p),h()}function p(){this.removeListener("disconnected",p),e.emit("remove-peer",this.peerId),h()}function h(){if(!y){var t=n.canHaveMorePeers(m);t>0&&g.triggerIn(2e3,[t])}}s=s||{};var f,l,d=t("directory"),m=2,y=!1;this.connect=function(t,o){f=t,l=o,e.socket.connected&&c(),e.on("connect",c),n.on("peer",u)},this.close=function(){y=!0,e.removeListener("connect",c),n.removeListener("peer",u)};var g=new i(function g(t){d("findiing peers for resource: "+f+" count: "+t),e.emit("request-peers",f,t),e.once("peers-found",a)},this)}function u(t){function e(e){this.set=function(o,i){if("object"!=typeof o)throw Error("First argument need to be an object!");t.emit("set-metadata",e,o),t.once("set-metadata-"+e,n(i))},this.get=function(o,i){if("string"==typeof o||"number"==typeof o)o=[o];else if(!o instanceof Array)throw Error("First argument need be a key or array of keys");t.emit("get-metadata",e,o),t.once("get-metadata-"+e,n(i))},this.getAll=function(o){t.emit("get-all-metadata",e),t.once("get-all-metadata-"+e,n(o))},this.remove=function(o,i){if("string"==typeof o||"number"==typeof o)o=[o];else if(!o instanceof Array)throw Error("First argument need be a key or array of keys");t.emit("remove-metadata",o),t.emit("remove-metadata-"+e,n(i))
}}function n(t){return function(){arguments[0]&&(arguments[0]=Error(arguments[0])),t.apply(null,arguments)}}this.createResource=function(e){t.emit("create-resource"),t.once("create-resource",n(e))},this.removeResource=function(e){t.emit("remove-resource"),t.once("remove-resource",n(e))},this.getResource=function(e){t.emit("get-resource"),t.once("get-resource",n(e))},this.loadMetadata=function(t){return new e(t)}}function p(e,n,o,i,r){function s(t,e,n){k("answer from: "+t+" with status: "+e);var o=y.peers[t];o?"ACCEPTED"==e?o.setRemote(n):o.close():k("no connection to answer: "+t)}function a(t,o){if(k("offer from: "+t),y.peers[t])k("offer rejected because of exisitng from: "+t),e.emit("answer",t,"REJECTED");else{var i=new c(n,t,"answered");i?(i.on("disconnected",l),i.on("candidate",h),i.on("connected",f),i.answer(o,function(n){e.emit("answer",t,"ACCEPTED",n)}),y.peers[t]=i,r.answerTimeout&&d(t,r.answerTimeout)):k("no connection to offer: "+t)}}function u(t,e){var n=y.peers[t];n?n.addCandidate(e):k("no connection to offer ice-candidate: "+t)}function p(t,e){if(k("server error on: "+t+" error: "+JSON.stringify(e)),e&&"NO_CLIENT"==e.code){var n=y.peers[e.to];n&&n.close()}}function h(t){e.emit("ice-candidate",this.peerId,t)}function f(){k("connecting: "+this.peerId),g++,y.emit("peer",this),this.removeListener("connected",f),m(this.peerId)}function l(){k("disconnecting: "+this.peerId),g--,delete y.peers[this.peerId],this.removeListener("disconnected",l),this.removeListener("candidate",h),this.removeListener("connected",f),m(this.peerId)}function d(t,e){v[t]=setTimeout(function(){var n=y.peers[t];n&&!n.connected&&(k("timeouting: "+t+" after: "+e),n.close(),v[t]=null)},e)}function m(t){var e=v[t];e&&(k("clearing timeout handler for: "+t),clearTimeout(e),v[t]=null)}r=r||{};var y=this;this.peers={};var g=0,v={},k=t("connection-manager");this.connectNew=function(t,o){o=o||{},k("start connecting with peer: "+t);var i=new c(n,t,"offered");i.on("disconnected",l),i.on("candidate",h),i.on("connected",f),this.peers[t]=i,i.offer(function(n){e.emit("offer",t,n)}),o.timeout&&d(t,o.timeout)},this.getConnectedPeerNames=function(){var t=[];for(var e in this.peers)this.peers[e].connected&&t.push(e);return e},this.getConnectedPeerCount=function(){return g},this.canHaveMorePeers=function(t){var e=i-g;return e>0?e>t?t:e:0},this.close=function(){e.removeListener("answer",s),e.removeListener("offer",a),e.removeListener("ice-candidate",u),e.removeListener("error",p);for(var t in this.peers)this.peers[t].close()},e.on("answer",s),e.on("offer",a),e.on("ice-candidate",u),e.on("error",p)}function h(){var t,e,n=o(),i={};this.connect=function(n){n=n||"http://localhost:5005",t=io.connect(n),e=new u(t),this.createResource=e.createResource.bind(e),this.removeResource=e.removeResource.bind(e),this.getResource=e.getResource.bind(e),this.connect=function(){}},this.disconnect=function(){for(var e in i)i[e].leave();t.disconnect()},this.join=function(o,r){r=r||{},r.maxPeers=r.maxPeers||5,r.answerTimeout=r.answerTimeout||6e4,r.offerTimeout=r.offerTimeout||6e4;var s=new f(n,t);return s.connect(o,r),s.metadata=e.loadMetadata(o),i[o]=s,s}}function f(t,e){function n(t){r.emit("peer",t)}var o,i,r=this;this.connect=function(r,s){var c={answerTimeout:s.answerTimeout};o=new p(e,r,t,s.maxPeers,c),o.on("peer",n);var u={offerTimeout:s.offerTimeout};i=new a(e,o,t,u),i.connect(r),this.connect=function(){}},this.leave=function(){o.removeListener("peer",n),i.close(),o.close()}}(function(t){"use strict";function e(){}function n(t,e){if(i)return e.indexOf(t);for(var n=e.length;n--;)if(e[n]===t)return n;return-1}var o=e.prototype,i=Array.prototype.indexOf?!0:!1;o._getEvents=function(){return this._events||(this._events={})},o.getListeners=function(t){var e=this._getEvents();return e[t]||(e[t]=[])},o.addListener=function(t,e){var o=this.getListeners(t);return-1===n(e,o)&&o.push(e),this},o.on=o.addListener,o.once=function(t,e){var n=this;this.on(t,function(){e.apply(n,arguments),n.removeListener(t,e)})},o.removeListener=function(t,e){var o=this.getListeners(t),i=n(e,o);return-1!==i&&(o.splice(i,1),0===o.length&&this.removeEvent(t)),this},o.off=o.removeListener,o.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},o.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},o.manipulateListeners=function(t,e,n){var o,i,r=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"==typeof e)for(o in e)e.hasOwnProperty(o)&&(i=e[o])&&("function"==typeof i?r.call(this,o,i):s.call(this,o,i));else for(o=n.length;o--;)r.call(this,e,n[o]);return this},o.removeEvent=function(t){return t?delete this._getEvents()[t]:delete this._events,this},o.emitEvent=function(t,e){for(var n,o=this.getListeners(t),i=o.length;i--;)n=e?o[i].apply(this,e):o[i].call(this),n===!0&&this.removeListener(t,o[i]);return this},o.trigger=o.emitEvent,o.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},"function"==typeof define&&define.amd?define(function(){return e}):t.EventEmitter=e})(this),t.names=[],t.skips=[],t.enable=function(e){try{localStorage.debug=e}catch(n){}for(var o=(e||"").split(/[\s,]+/),i=o.length,r=0;i>r;r++)e=o[r].replace("*",".*?"),"-"===e[0]?t.skips.push(RegExp("^"+e.substr(1)+"$")):t.names.push(RegExp("^"+e+"$"))},t.disable=function(){t.enable("")},t.humanize=function(t){var e=1e3,n=6e4,o=60*n;return t>=o?(t/o).toFixed(1)+"h":t>=n?(t/n).toFixed(1)+"m":t>=e?(0|t/e)+"s":t+"ms"},t.enabled=function(e){for(var n=0,o=t.skips.length;o>n;n++)if(t.skips[n].test(e))return!1;for(var n=0,o=t.names.length;o>n;n++)if(t.names[n].test(e))return!0;return!1},window.localStorage&&t.enable(localStorage.debug),window.RTCPeerConnection||(navigator.mozGetUserMedia?(window.RTCSessionDescription=window.mozRTCSessionDescription,window.RTCPeerConnection=window.mozRTCPeerConnection,window.getUserMedia=navigator.mozGetUserMedia.bind(navigator)):navigator.webkitGetUserMedia&&(window.RTCPeerConnection=window.webkitRTCPeerConnection,window.getUserMedia=navigator.webkitGetUserMedia.bind(navigator))),e(c,EventEmitter),c.prototype.offer=function(t){var e=this;this.me.createOffer(function(n){e.logger("offer created"),e.me.setLocalDescription(n),t(n)})},c.prototype.answer=function(t,e){t instanceof RTCSessionDescription||(t=new RTCSessionDescription(t));var n=this;this.me.setRemoteDescription(t),this.me.createAnswer(function(t){n.logger("answer created"),n.me.setLocalDescription(t),e(t)})},c.prototype.send=function(t){this.logger("sending message: "+t),this.meData.send(t)},c.prototype.setRemote=function(t){t instanceof RTCSessionDescription||(t=new RTCSessionDescription(t)),this.logger("setting remote"),this.me.setRemoteDescription(t)},c.prototype.addCandidate=function(t){this.iceLogger("adding ice candidate: "+t.sdpMid),"disconnected"!=this.me.iceConnectionState&&this.me.addIceCandidate(new RTCIceCandidate(t))},c.prototype.close=function(){this.me.close(),this.me.onicecandidate=null,this.me.onicechange=null,this.meData.onmessage=null,this.meData.onopen=null,this.meData.onclose=null,this.logger("closed"),this.emit("disconnected")},c.prototype._onIceCandidate=function(t){t.candidate&&"data"==t.candidate.sdpMid&&(this.iceLogger("receiving ice candidate: "+t.candidate.candidate),this.emit("candidate",t.candidate))},c.prototype._notifyMessage=function(t){this.logger("receiving message: "+t.data),this.emit("message",t.data)},c.prototype._notifyOpen=function(){this.logger("state changed: connected"),this.connected=!0,this.emit("connected")},c.prototype._onIceChange=function(){this.logger("changing ice status: "+this.me.iceConnectionState),"disconnected"==this.me.iceConnectionState&&this.close()},e(p,EventEmitter),e(f,EventEmitter);var l=s(),d=l.server||"http://localhost:5005";if(l.debug){var m=decodeURI(l.debug).split(",");m.forEach(function(e){t.names.push(RegExp(e.trim()))})}var y=window.peerman=new h;y.connect(d)}();